<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Обработка QR</title>
  <script>
    async function triggerWebhook() {
      const params = new URLSearchParams(window.location.search);
      const elementId = params.get("elementId");
      const entityTypeId = params.get("entityTypeId");

      if (!elementId || !entityTypeId) {
        document.body.innerHTML = "Ошибка: нет параметров";
        return;
      }

      const webhookUrl = "https://portal.proprof.pro/rest/34/j34sppzig9zmsm40/bizproc.workflow.start";
      
      const data = {
        "TEMPLATE_ID": 433, // ID бизнес-процесса
        "DOCUMENT_ID": [`crm`, `Bitrix\\Crm\\Integration\\BizProc\\Document\\Dynamic_${entityTypeId}`,
  elementId
],
        "PARAMETERS": {
          "WHO_SCANNED": "QR" // пример параметра
        }
      };

      try {
  const response = await fetch(webhookUrl, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data)
  });

  const result = await response.json();
  console.log(result); // Для консоли разработчика
  document.body.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
} catch (e) {
  document.body.innerHTML = "Ошибка запуска бизнес-процесса.";
  console.error(e);
}
    }

    window.onload = triggerWebhook;
  </script>
</head>
<body>
  <p>⏳ Обработка...</p>
</body>
</html>
