<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Обработка QR</title>
  <script>
    async function triggerWebhook() {
      const params = new URLSearchParams(window.location.search);
      const elementId = params.get("elementId");
      const entityTypeId = params.get("entityTypeId");

      if (!elementId || !entityTypeId) {
        document.body.innerHTML = "Ошибка: нет параметров";
        return;
      }

      const webhookUrl = "https://portal.proprof.pro/rest/34/j34sppzig9zmsm40/";
      
      const data = {
        "TEMPLATE_ID": 123, // ID бизнес-процесса
        "DOCUMENT_ID": [`crm`, `item`, `DYNAMIC_${entityTypeId}_${elementId}`],
        "PARAMETERS": {
          "WHO_SCANNED": "QR" // пример параметра
        }
      };

      try {
        await fetch(webhookUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        document.body.innerHTML = "✅ Уведомление отправлено, проверьте приложение";
      } catch (e) {
        document.body.innerHTML = "Ошибка запуска бизнес-процесса.";
      }
    }

    window.onload = triggerWebhook;
  </script>
</head>
<body>
  <p>⏳ Обработка...</p>
</body>
</html>